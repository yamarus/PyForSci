

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ru" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ru" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Библиотека SciPy &mdash; документация Основы Python для работы с научными данными </title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="9. Введение в ООП. Настройка окружения и установка пакетов" href="theme9.html" />
    <link rel="prev" title="7. Работа с графиками" href="theme7.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #6495ED" >
          

          
            <a href="index.html" class="icon icon-home"> Основы Python для работы с научными данными
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="theme1.html">1. Введение. Установка интерпретатора Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme1.html#id3">1.1. О языке Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme1.html#id4">1.2. Установка интерпретатора Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme1.html#anaconda">1.2.1. Установка Anaconda на свой компьютер</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme1.html#id9">1.2.2. Установка стандартных средств для python разработки</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme2.html">2. Основы Синтаксиса Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id2">2.1. Форматирование блоков кода</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id3">2.2. Динамическая типизация</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id4">2.3. Ввод и вывод в консоль</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id5">2.4. Ключевые слова и встроенные функции в Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id8">2.5. Основные операторы и типы данных</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id9">2.5.1. Логические переменные</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id10">2.5.2. Числовые переменные</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id11">2.5.3. Списки и кортежи</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id12">2.5.4. Словари и множества</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id13">2.5.5. Строки</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id14">2.5.6. Операторы сравнения</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#id15">2.5.7. Условные операторы</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#while">2.5.8. Цикл while</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme2.html#for-range">2.5.9. Цикл for и функция range</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme2.html#id16">2.6. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme3.html">3. Числа и списки</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme3.html#id2">3.1. Числа</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#int">3.1.1. Целые числа (int)</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#float">3.1.2. Числа с плавающей запятой (float)</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#complex">3.1.3. Комплексные числа (complex)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme3.html#math">3.2. Модуль math</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme3.html#list">3.3. Списки (list)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#id7">3.3.1. Обращения к элементам списка</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#id8">3.3.2. Срезы списков</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#id9">3.3.3. Свойства списков</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme3.html#id10">3.3.4. Некоторые операции со списками</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme3.html#id11">3.4. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme4.html">4. Функции и строки</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme4.html#id2">4.1. Функции</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#id3">4.1.1. Функции</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#id4">4.1.2. Аргументы функции</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#lambda">4.1.3. Lambda функции</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme4.html#id5">4.2. Строки</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#id6">4.2.1. Литералы строк.</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#id9">4.2.2. Методы и функции строк</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme4.html#format">4.2.3. Форматирование строк. Метод <code class="docutils literal notranslate"><span class="pre">.format()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme4.html#id12">4.3. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme5.html">5. Работа с файлами, модуль <code class="docutils literal notranslate"><span class="pre">os</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme5.html#id1">5.1. Работа с файлами</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme5.html#id2">5.1.1. Файловая система</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme5.html#python">5.1.2. Стандартные методы Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme5.html#with-as-try-except">5.1.3. Конструкции <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">..</span> <span class="pre">as</span></code> и <code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">..</span> <span class="pre">except</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme5.html#id4">5.2. Модуль <code class="docutils literal notranslate"><span class="pre">os</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="theme5.html#id7">5.3. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme6.html">6. NumPy массивы и их свойства</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme6.html#id1">6.1. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme6.html#id3">6.2. Массивы NumPy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme6.html#id6">6.2.1. Базовые методы масивов NumPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme6.html#id7">6.2.2. Оси и форма массивов</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme6.html#id8">6.2.3. Создание шаблонных массивов NumPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme6.html#copy">6.2.4. Метод <code class="docutils literal notranslate"><span class="pre">copy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="theme6.html#id10">6.2.5. NumPy работа с файлами</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme6.html#scipy-linalg">6.3. Линейная алгебра и SciPy.linalg</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme6.html#id15">6.4. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme7.html">7. Работа с графиками</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#matplotlib">7.1. Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#id3">7.2. Свойства линии и точки</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id4">7.2.1. Итерационная задача цветов</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#id5">7.3. Оформление</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#matplotlib-rcparams">7.3.1. matplotlib rcParams</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id7">7.3.2. Легенда</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id8">7.3.3. Заголовки и подписи</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#matplotlib-axes">7.4. Несколько графиков на картинке, matplotlib.axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#id10">7.5. Масштаб и оси</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id11">7.5.1. Пределы отображения и масштабирование</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id12">7.5.2. Оси и сетка</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id13">7.5.3. Двойные оси.</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme7.html#id14">7.5.4. Общая ось для двух соседних графиков</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#id15">7.6. Гистограммы</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#d">7.7. 2D графики</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme7.html#id16">7.8. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Библиотека SciPy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scipy-linalg">8.1. Линейная алгебра (<code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scipy-integrate">8.2. Интегрирование и работа с обыкновенными дифференциальными уравнениями (<code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">8.2.1. Интегрирование функций</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">8.2.2. Интегрирование по заданному набору точек</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">8.2.3. Интегрирование ОДУ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scipy-optimize">8.3. Фитирование кривых, нахождение минимума функции, решение уравнений с <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">8.3.1. Фитирование кривых</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">8.3.2. Минимизация функции</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">8.3.3. Поиск корней уравнения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">8.4. #Экспериментаторы рекомендуют</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">8.5. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme9.html">9. Введение в ООП. Настройка окружения и установка пакетов</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme9.html#python">9.1. Установка пакетов и настройка окружения в Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#pip-conda">9.1.1. <code class="docutils literal notranslate"><span class="pre">pip</span></code> и <code class="docutils literal notranslate"><span class="pre">conda</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id2">9.1.2. Настройка окружения в Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme9.html#id4">9.2. Основы ООП</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id6">9.2.1. Зачем это надо?</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id7">9.2.2. Классы в Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id8">9.2.3. Специальные (магические) методы</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id9">9.2.4. Инициализация объекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id10">9.2.5. Итерация по объекту</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme9.html#id11">9.2.6. Определение арифметических и логических операций</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme9.html#id12">9.3. Большой пример.</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme9.html#id13">9.4. Задачи</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme10.html">10. Pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme10.html#id2">10.1. Основные классы для хранения данных в Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme10.html#dataframe">10.2. Изменение DataFrame</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme10.html#id3">10.2.1. Дополнение объекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="theme10.html#id4">10.2.2. Индексация DataFrame</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme10.html#id5">10.3. Загрузка экспериментальных данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme10.html#id7">10.4. Построение графиков из экспериментальных данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme10.html#id8">10.5. Манипуляции с данными.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theme11.html">11. Полезные библиотеки для python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#pandas">11.1. Pandas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme11.html#id3">11.1.1. Один пример работы Pandas. Загрузка экспериментальных данных</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#seaborn">11.2. Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#sympy">11.3. SymPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#symfit">11.4. symfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#scikit-learn">11.5. scikit-learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#svgwrite">11.6. svgwrite</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#awesome-python-chemistry">11.7. Awesome Python Chemistry</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#rdkit">11.8. RDKit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme11.html#datamol">11.8.1. datamol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#open-babel">11.9. Open Babel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theme11.html#pybel">11.9.1. Pybel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#pycroscopy">11.10. Pycroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#stk">11.11. stk</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#nglviewer">11.12. nglviewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#mdtraj">11.13. MDTraj</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#python-docx">11.14. python-docx</a></li>
<li class="toctree-l2"><a class="reference internal" href="theme11.html#sphinx">11.15. SPHINX</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Основы Python для работы с научными данными</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Библиотека SciPy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="theme9.html" class="btn btn-neutral float-right" title="9. Введение в ООП. Настройка окружения и установка пакетов" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="theme7.html" class="btn btn-neutral float-left" title="7. Работа с графиками" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scipy">
<span id="theme8"></span><h1><span class="section-number">8. </span>Библиотека SciPy<a class="headerlink" href="#scipy" title="Ссылка на этот заголовок">¶</a></h1>
<p><a class="reference external" href="../../source/lectures/theme8.ipynb">Лекция в .ipynb формате</a></p>
<p>Библиотека <code class="docutils literal notranslate"><span class="pre">scipy</span></code> обладает большим функционалом для работы с данными
(<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">документация</a>, <a class="reference external" href="https://scipy-lectures.org/">полезный набор примеров</a>).</p>
<p>Из основных модулей хочется выделить следующие:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>модуль</p></th>
<th class="head"><p>функционал</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code></p></td>
<td><p>Linear algebra</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code></p></td>
<td><p>Integration and ODEs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code></p></td>
<td><p>Optimization and root finding</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.interpolate</span></code></p></td>
<td><p>Interpolation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.fft</span></code></p></td>
<td><p>Discrete Fourier transforms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code></p></td>
<td><p>Statistical functions</p></td>
</tr>
</tbody>
</table>
<p><strong>Важно:</strong> Документация расчитана на подготовленного читателя и для
работы со многими модулями необходимо понимать хотя бы на базовом уровне
как реализуются те, или иные методы.</p>
<p>В данной лекции приведен лишь обзор некоторых реализованных в библиотеки
функций. Более подробнее можно почитать в <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/index.html">туториалах scipy</a>.</p>
<p>Рассмотрим пример использования библиотеки для простейшей линейной
регресии <code class="docutils literal notranslate"><span class="pre">scipy.stats.linregress</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="c1">#создаем линию</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span><span class="mi">3</span>

<span class="c1">#добавляем шум</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ks&#39;</span><span class="p">)</span>

<span class="c1">#делаем линейную регрессию</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1">#выводим результат</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1">#получаем параметры прямой</span>
<span class="n">a</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">slope</span>
<span class="n">b</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">intercept</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;$y = </span><span class="si">{:.4f}</span><span class="s1"> x </span><span class="si">{:+.4f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>

<span class="c1">#строим прямую</span>
<span class="n">fitted_y</span><span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span><span class="n">result</span><span class="o">.</span><span class="n">intercept</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fitted_y</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LinregressResult</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="mf">2.0120484283981086</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=-</span><span class="mf">3.080383665663901</span><span class="p">,</span> <span class="n">rvalue</span><span class="o">=</span><span class="mf">0.9980439003977739</span><span class="p">,</span> <span class="n">pvalue</span><span class="o">=</span><span class="mf">3.953703901084055e-23</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="mf">0.02970643441942163</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/output_2_1.png" src="_images/output_2_1.png" />
<div class="section" id="scipy-linalg">
<h2><span class="section-number">8.1. </span>Линейная алгебра (<code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code>)<a class="headerlink" href="#scipy-linalg" title="Ссылка на этот заголовок">¶</a></h2>
<p>Примеры работы с данным модулем приводились ранее в разделе про NumPy.
Хочется лишь еще раз отметить, что функционал <code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code>
значительно обширнее одноименного модуля <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p>
</div>
<div class="section" id="scipy-integrate">
<h2><span class="section-number">8.2. </span>Интегрирование и работа с обыкновенными дифференциальными уравнениями (<code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code>)<a class="headerlink" href="#scipy-integrate" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id4">
<h3><span class="section-number">8.2.1. </span>Интегрирование функций<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для интегрирования функций можно выделить несколько простых методов
модуля <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code> (их как обычно больше. Читайте документацию
перед выбором метода для каждой конкретной задачи!):</p>
<p><code class="docutils literal notranslate"><span class="pre">quad(func,</span> <span class="pre">a,</span> <span class="pre">b[,</span> <span class="pre">args,</span> <span class="pre">full_output,</span> <span class="pre">…])</span></code> - Compute a definite
integral</p>
<p><code class="docutils literal notranslate"><span class="pre">dblquad(func,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">gfun,</span> <span class="pre">hfun[,</span> <span class="pre">args,</span> <span class="pre">…])</span></code> - Compute a double
integral.</p>
<p><code class="docutils literal notranslate"><span class="pre">tplquad(func,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">gfun,</span> <span class="pre">hfun,</span> <span class="pre">qfun,</span> <span class="pre">rfun)</span></code> - Compute a triple
(definite) integral.</p>
<p><code class="docutils literal notranslate"><span class="pre">nquad(func,</span> <span class="pre">ranges[,</span> <span class="pre">args,</span> <span class="pre">opts,</span> <span class="pre">full_output])</span></code> - Integration over
multiple variables.</p>
<p>Рассмотрим несколько примеров их использования. Проинтегрируем функцию
<span class="math notranslate nohighlight">\(\int_0^1 x^2 dx =\frac{x^3}{3}\biggr\rvert_{0}^1\frac{1}{3}\)</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="c1">#задаем функцию x2, которая возвращает x**2.</span>
<span class="c1">#тоже можно через def x2(x):...</span>
<span class="n">x2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.33333333333333337</span>
<span class="mf">5.551115123125783e-17</span> <span class="mf">3.700743415417189e-15</span>
</pre></div>
</div>
<p>сделаем тоже для <span class="math notranslate nohighlight">\(\iint x^2 +y^2 dx dy =\frac{2}{3}\)</span> .</p>
<p>Для этого используем <code class="docutils literal notranslate"><span class="pre">dblquad(func,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">gfun,</span> <span class="pre">hfun[,</span> <span class="pre">args,</span> <span class="pre">…])</span></code></p>
<p>пределы по <span class="math notranslate nohighlight">\(y\)</span> передаются через функции <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">gfun(x)..hfun(x)</span></code>.
Такой подход может быть удобен в случае, если нужно проинтегрировать в
виде <span class="math notranslate nohighlight">\(\int_0^{1} dy \int_0^y f(x,y) dx\)</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x2_y2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span>

<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">x2_y2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.6666666666666669</span>
<span class="mf">2.220446049250313e-16</span> <span class="mf">1.4754810833321613e-14</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nquad</span></code> выполняет <code class="docutils literal notranslate"><span class="pre">quad</span></code> несколько раз. Пределы передаются в видет
итерируемого объекта (например списка). Где каждый элемент является либо
функцией, возвращающей значения в виде пары элементов, либо просто
итерируемым объектом длины 2.</p>
</div>
<div class="section" id="id5">
<h3><span class="section-number">8.2.2. </span>Интегрирование по заданному набору точек<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Проводит интегрирование значений <span class="math notranslate nohighlight">\(f_k = f(x_k)\)</span> для заданного
набора значений <span class="math notranslate nohighlight">\(f\)</span> и <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Рассмотрим два примера такого интегрирования. С остальными методами
рекомендуется ознакомиться самостоятельно:</p>
<p><code class="docutils literal notranslate"><span class="pre">trapz(y[,</span> <span class="pre">x,</span> <span class="pre">dx,</span> <span class="pre">axis])</span></code> - Integrate along the given axis using the
composite trapezoidal rule.</p>
<p><code class="docutils literal notranslate"><span class="pre">simps(y[,</span> <span class="pre">x,</span> <span class="pre">dx,</span> <span class="pre">axis,</span> <span class="pre">even])</span></code> - Integrate y(x) using samples along
the given axis and the composite Simpson’s rule.</p>
<p>Если у нас есть набор из <span class="math notranslate nohighlight">\(N\)</span> точек <span class="math notranslate nohighlight">\(f(x)\)</span>, то определенный
интеграл можно рассчитать следующим образом:</p>
<p><span class="math notranslate nohighlight">\(\int_a^b f(x) dx \approx \sum_{k=1}^{N} \frac{f(x_{k-1}) + f(x_{k})}{2} \Delta x\)</span></p>
<p><img alt="220px-Trapezoidal_rule_illustration.svg.png" src="_images/220px-Trapezoidal_rule_illustration.svg.png" /> <em>картинка с wikipedia.org</em></p>
<p>У такого метода довольно высокая ошибка. Для того чтобы ее уменьшить,
можно рассматривать точки не парами, а тройками, интреполируя значение
функции между ними квадратичной функцией. Такой подход обладает намного
более высокой точностью и называется методом Симпсона:</p>
<p><span class="math notranslate nohighlight">\(\int_a^b f(x) dx \approx \frac{\Delta x}{3} \sum_{j=1}^{n/2}\bigg[f(x_{2j-2})+4f(x_{2j-1})+f(x_{2j})\bigg]\)</span></p>
<p><img alt="Simpsons_method_illustration.svg.png" src="_images/Simpsons_method_illustration.svg.png" /> <em>картинка с wikipedia.org</em></p>
<p>Рассмотрим примеры их работы для интеграла
<span class="math notranslate nohighlight">\(\int_0^\pi sin(x) dx = 2\)</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Метод трапеций: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Метод Симпсона: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Метод</span> <span class="n">трапеций</span><span class="p">:</span> <span class="mf">1.8961188979370398</span>
<span class="n">Метод</span> <span class="n">Симпсона</span><span class="p">:</span> <span class="mf">2.0045597549844207</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3><span class="section-number">8.2.3. </span>Интегрирование ОДУ<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Модуль <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code> позволяет решить задачу Коши:</p>
<p><span class="math notranslate nohighlight">\(\left\{\begin{array}{lcl}\frac{dy}{dx} &amp;=&amp; f(x,y) \\ y(x_0) &amp;=&amp; y_0\end{array}\right.\)</span></p>
<p>Для построения схемы интегрирования функцию <span class="math notranslate nohighlight">\(f(x,y)\)</span> в каждой
точке раскладывают в ряд Тейлора, что приводит к следующему результату:</p>
<p><span class="math notranslate nohighlight">\(y(x_{k+1}) = y(x_k) + y'(x_k)\Delta x + y''(x_k)\frac{\Delta x^2}{2} + ...\)</span></p>
<p>Учет лишь первых двух слагаемых является простейшим подходом для решения
данной задачи и называется методом Эйлера. В данном модуле он в явном
виде не реализован. Приблизительный учет членов более высокого порядка
приводит к серии методов <strong>Рунге-Кутты</strong>, которые являются стандартными
в модуле <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code>.</p>
<p>В базовой функции для интегрирования ОДУ применяется
<code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp(fun,</span> <span class="pre">t_span,</span> <span class="pre">y0,</span> <span class="pre">method='RK45',</span> <span class="pre">t_eval=None,</span> <span class="pre">dense_output=False,</span> <span class="pre">events=None,</span> <span class="pre">vectorized=False,</span> <span class="pre">args=None,</span> <span class="pre">**options)</span></code></p>
<p>Расмотрим пример использования данного модуля <span class="math notranslate nohighlight">\(y' = \sin(t)\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">res</span><span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="c1">#пределы интегрирования t_span</span>
                          <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],)</span>  <span class="c1"># y0</span>
                          <span class="c1">#t_eval=list(range(11)))  #точки которые хотим получить на выходе</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">)),</span>  <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;The solver successfully reached the end of the integration interval.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">56</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">0</span>
     <span class="n">nlu</span><span class="p">:</span> <span class="mi">0</span>
     <span class="n">sol</span><span class="p">:</span> <span class="kc">None</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
       <span class="n">t</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.00000000e+00</span><span class="p">,</span> <span class="mf">1.00000000e-04</span><span class="p">,</span> <span class="mf">1.10000000e-03</span><span class="p">,</span> <span class="mf">1.11000000e-02</span><span class="p">,</span>
      <span class="mf">1.11100000e-01</span><span class="p">,</span> <span class="mf">1.11110000e+00</span><span class="p">,</span> <span class="mf">3.53314302e+00</span><span class="p">,</span> <span class="mf">6.03426368e+00</span><span class="p">,</span>
      <span class="mf">8.29799322e+00</span><span class="p">,</span> <span class="mf">1.00000000e+01</span><span class="p">])</span>
<span class="n">t_events</span><span class="p">:</span> <span class="kc">None</span>
       <span class="n">y</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span>        <span class="p">,</span> <span class="o">-</span><span class="mf">1.</span>        <span class="p">,</span> <span class="o">-</span><span class="mf">0.9999994</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.9999384</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.99383474</span><span class="p">,</span>
       <span class="o">-</span><span class="mf">0.44367774</span><span class="p">,</span>  <span class="mf">0.92423617</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.96878542</span><span class="p">,</span>  <span class="mf">0.42963013</span><span class="p">,</span>  <span class="mf">0.83916286</span><span class="p">]])</span>
<span class="n">y_events</span><span class="p">:</span> <span class="kc">None</span>
</pre></div>
</div>
<img alt="_images/output_12_11.png" src="_images/output_12_11.png" />
<p>Строим график для модели Лотки — Вольтерра (хищник - жертва)</p>
<p><span class="math notranslate nohighlight">\(\left\{\begin{array}{lcl}y_0' &amp;=&amp; (2-y_1)y_0 \\ y_1' &amp;=&amp; (-2 + y_0)y_1\end{array}\right.\)</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">d0</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">d1</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">d0</span><span class="p">,</span><span class="n">d1</span><span class="p">]</span>
<span class="n">res</span><span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                          <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">t_eval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y_0$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_0$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/output_14_0.png" src="_images/output_14_0.png" />
</div>
</div>
<div class="section" id="scipy-optimize">
<h2><span class="section-number">8.3. </span>Фитирование кривых, нахождение минимума функции, решение уравнений с <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code><a class="headerlink" href="#scipy-optimize" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id7">
<h3><span class="section-number">8.3.1. </span>Фитирование кривых<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для простого фитирования кривых подходит метод
<code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit(f,</span> <span class="pre">xdata,</span> <span class="pre">ydata,</span> <span class="pre">p0=None,</span> <span class="pre">sigma=None,</span> <span class="pre">absolute_sigma=False,</span> <span class="pre">check_finite=True,</span> <span class="pre">bounds=-</span> <span class="pre">inf,</span> <span class="pre">inf,</span> <span class="pre">method=None,</span> <span class="pre">jac=None,</span> <span class="pre">**kwargs)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">f</span></code> <strong>callable</strong> The model function, <code class="docutils literal notranslate"><span class="pre">f(x,</span> <span class="pre">…)</span></code>. It must take the
independent variable as the first argument and the parameters to fit as
separate remaining arguments.</p>
<p><code class="docutils literal notranslate"><span class="pre">xdata</span></code> <strong>array_like or object</strong> The independent variable where the
data is measured. Should usually be an M-length sequence or an
(k,M)-shaped array for functions with k predictors, but can actually be
any object.</p>
<p><code class="docutils literal notranslate"><span class="pre">ydata</span></code> <strong>array_like</strong> The dependent data, a length M array -
nominally <code class="docutils literal notranslate"><span class="pre">f(xdata,</span> <span class="pre">...)</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">p0</span></code> <strong>array_like, optional</strong> Initial guess for the parameters (length
N). If <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the initial values will all be 1 (if the number of
parameters for the function can be determined using introspection,
otherwise a ValueError is raised).</p>
<p><code class="docutils literal notranslate"><span class="pre">bounds</span></code> <strong>2-tuple of array_like, optional</strong> Lower and upper bounds on
independent variables. Defaults to no bounds. Each array must match the
size of <code class="docutils literal notranslate"><span class="pre">x0</span></code> or be a scalar, in the latter case a bound will be the
same for all variables. Use <code class="docutils literal notranslate"><span class="pre">np.inf</span></code> with an appropriate sign to
disable bounds on all or some variables.</p>
<p>Рассмотрим пример фитирования кривой вида <span class="math notranslate nohighlight">\($y(t) = A -B\exp(-k t)\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="c1"># задаем функцию</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="c1"># строим исходную функцию</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;original data&#39;</span><span class="p">)</span>

<span class="c1"># генерируем шумные данные</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>

<span class="c1">#фитируем</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span>

<span class="c1"># строим оптимизированную функцию</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;optimized data&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">2.04170899</span> <span class="mf">1.9145262</span>  <span class="mf">0.08003846</span><span class="p">]</span>
</pre></div>
</div>
<img alt="_images/output_16_1.png" src="_images/output_16_1.png" />
</div>
<div class="section" id="id8">
<h3><span class="section-number">8.3.2. </span>Минимизация функции<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>В некоторых случаях вам может потребоваться найти минимум или максимум
какой-либо функции. Иногда, это приходится делать так как метод
<code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> не справляется с поставленной задачей. В
функции <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minize</span></code> реализованно огромное количество
методов поиска локального минимума.</p>
<p>Простейший метод поиска минимума функции является следование против
градиента (градиентный спуск), где положение минимума значения функции
<span class="math notranslate nohighlight">\(F(x)\)</span> находится последовательным приближением к нему. Каждое
последующее значение <span class="math notranslate nohighlight">\(x_{j+1}\)</span> задается следующим образом:</p>
<p><span class="math notranslate nohighlight">\(\vec{x_{j+1}} = \vec{x_{j}} - \lambda_j \nabla F (\vec{x_j})\)</span>,</p>
<p>где <span class="math notranslate nohighlight">\(\lambda\)</span> - скорость спуска. В простейшем случае
<span class="math notranslate nohighlight">\(\lambda=\textrm{const}\)</span>, в более продвинутых модификациях
<span class="math notranslate nohighlight">\(\lambda\)</span> выбирается исходя из скорости изменения функции. Данный
метод приведен тут для примера, т.к. не требует больших познаний в
математике для понимания того, как он работает. Более продвинутые методы
работаю схожим образом, однако, выбор направления и шага происходит
более сложным образом, в т.ч. с учетом и <span class="math notranslate nohighlight">\(j-2\)</span> шага, что позволяет
достичь большей точности и лучшей сходимости.</p>
<div class="admonition warning">
<p class="admonition-title">Предупреждение</p>
<p><strong>Все эти методы не гарантируют нахождения глобального минимума функции, а стремяться лишь к локальному.</strong> Для поиска глобальных минимумов можно использовать <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#global-optimization">другие функции</a>, однако, зачастую они требуют колоссальных вычислительных ресурсов.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Если минимизация проходит медленно или не сходится, попробуйте проварьировать шаг дифференцирования или использовать другой метод.</p>
</div>
<p>Рассмотрим пример использования данной функции для поиска минимума
функции <span class="math notranslate nohighlight">\((x-2)^2 + y^2\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># задаем функцию</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">var</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>  <span class="c1">#иногда полезно посмотреть что делает метод с вашей функцией</span>
    <span class="n">a</span><span class="o">=</span><span class="n">args</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span>

<span class="n">initial_pos</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="o">-</span><span class="mi">31</span><span class="p">)</span> <span class="c1"># начальные координаты поиска x0,y0</span>
<span class="n">res</span><span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
                       <span class="n">initial_pos</span><span class="p">,</span>
                       <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="c1">#method = &#39;l-bfgs-b&#39;,</span>
                      <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">минимум в точке (x,y) = (</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">17.0</span> <span class="o">-</span><span class="mf">31.0</span>
<span class="mf">17.00000001490116</span> <span class="o">-</span><span class="mf">31.0</span>
<span class="mf">17.0</span> <span class="o">-</span><span class="mf">31.00000001490116</span>
<span class="mf">16.560083462614678</span> <span class="o">-</span><span class="mf">30.090839156070334</span>
<span class="mf">16.56008347751584</span> <span class="o">-</span><span class="mf">30.090839156070334</span>
<span class="mf">16.560083462614678</span> <span class="o">-</span><span class="mf">30.090839170971496</span>
<span class="mf">14.800417313073387</span> <span class="o">-</span><span class="mf">26.454195780351668</span>
<span class="mf">14.800417327974548</span> <span class="o">-</span><span class="mf">26.454195780351668</span>
<span class="mf">14.800417313073387</span> <span class="o">-</span><span class="mf">26.45419579525283</span>
<span class="mf">9.975507532850603</span> <span class="o">-</span><span class="mf">16.482726027235138</span>
<span class="mf">9.975507547751764</span> <span class="o">-</span><span class="mf">16.482726027235138</span>
<span class="mf">9.975507532850603</span> <span class="o">-</span><span class="mf">16.4827260421363</span>
<span class="mf">2.0000128488064624</span> <span class="mf">1.0009687230194686e-06</span>
<span class="mf">2.0000128637076235</span> <span class="mf">1.0009687230194686e-06</span>
<span class="mf">2.0000128488064624</span> <span class="mf">1.0158698842133163e-06</span>
<span class="mf">1.9999891799123668</span> <span class="o">-</span><span class="mf">5.239360281676188e-06</span>
<span class="mf">1.999989194813528</span> <span class="o">-</span><span class="mf">5.239360281676188e-06</span>
<span class="mf">1.9999891799123668</span> <span class="o">-</span><span class="mf">5.254261442870035e-06</span>
<span class="mf">2.0000005918769377</span> <span class="o">-</span><span class="mf">2.2305837319811206e-06</span>
<span class="mf">2.000000606778099</span> <span class="o">-</span><span class="mf">2.2305837319811206e-06</span>
<span class="mf">2.0000005918769377</span> <span class="o">-</span><span class="mf">2.2454848931749683e-06</span>
     <span class="n">fun</span><span class="p">:</span> <span class="mf">5.3258220947402634e-12</span>
<span class="n">hess_inv</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mf">0.90514367</span><span class="p">,</span> <span class="mf">0.19603683</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.19603683</span><span class="p">,</span> <span class="mf">0.59485635</span><span class="p">]])</span>
     <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.19865504e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.47606863e-06</span><span class="p">])</span>
 <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">21</span>
     <span class="n">nit</span><span class="p">:</span> <span class="mi">4</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">7</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
       <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">2.00000059e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.23058373e-06</span><span class="p">])</span>

<span class="n">минимум</span> <span class="n">в</span> <span class="n">точке</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.9999999950011584</span><span class="p">,</span> <span class="mf">5.0043871932360456e-09</span><span class="p">)</span>
</pre></div>
</div>
<p>попробуем провести фитирование как было сделанно с <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># задаем функцию</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># строим исходную функцию</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;original data&#39;</span><span class="p">)</span>

<span class="c1"># генерируем шумные данные</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>


<span class="c1">#задаем функцию ошибок</span>
<span class="k">def</span> <span class="nf">err_f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">t</span><span class="p">,</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">ydata</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>




<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="n">res</span><span class="o">=</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">err_f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span> <span class="p">)</span>
<span class="n">popt</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="c1">#рисуем результат</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;optimized data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/output_20_0.png" src="_images/output_20_0.png" />
</div>
<div class="section" id="id10">
<h3><span class="section-number">8.3.3. </span>Поиск корней уравнения<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для поиска корней уравнения <span class="math notranslate nohighlight">\(f(x)=0\)</span> реализована функция
<code class="docutils literal notranslate"><span class="pre">scipy.optimize.root_scalar(f,</span> <span class="pre">args=(),</span> <span class="pre">method=None,</span> <span class="pre">bracket=None,</span> <span class="pre">fprime=None,</span> <span class="pre">fprime2=None,</span> <span class="pre">x0=None,</span> <span class="pre">x1=None,</span> <span class="pre">xtol=None,</span> <span class="pre">rtol=None,</span> <span class="pre">maxiter=None,</span> <span class="pre">options=None)</span></code></p>
<p>Рассмотрим примеры ее работы:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=-</span><span class="mi">3</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">converged</span><span class="p">:</span> <span class="kc">True</span>
          <span class="n">flag</span><span class="p">:</span> <span class="s1">&#39;converged&#39;</span>
<span class="n">function_calls</span><span class="p">:</span> <span class="mi">10</span>
    <span class="n">iterations</span><span class="p">:</span> <span class="mi">9</span>
          <span class="n">root</span><span class="p">:</span> <span class="mf">0.9999999999999816</span>

     <span class="n">converged</span><span class="p">:</span> <span class="kc">True</span>
          <span class="n">flag</span><span class="p">:</span> <span class="s1">&#39;converged&#39;</span>
<span class="n">function_calls</span><span class="p">:</span> <span class="mi">4</span>
    <span class="n">iterations</span><span class="p">:</span> <span class="mi">3</span>
          <span class="n">root</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0</span>

     <span class="n">converged</span><span class="p">:</span> <span class="kc">True</span>
          <span class="n">flag</span><span class="p">:</span> <span class="s1">&#39;converged&#39;</span>
<span class="n">function_calls</span><span class="p">:</span> <span class="mi">9</span>
    <span class="n">iterations</span><span class="p">:</span> <span class="mi">8</span>
          <span class="n">root</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.9999999999999787</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><span class="section-number">8.4. </span>#Экспериментаторы рекомендуют<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для вычета базовой линии использовать алгоритм <a class="reference external" href="https://stackoverflow.com/questions/29156532/python-baseline-correction-library">Asymmetric Least Squares Baseline correction</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>

<span class="k">def</span> <span class="nf">baseline_als</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">4e7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Asymmetric Least Squares Baseline correction.</span>
<span class="sd">    There are two parameters:</span>
<span class="sd">    p for asymmetry and λ for smoothness.</span>
<span class="sd">    Both have to be tuned to the data at hand.</span>
<span class="sd">    We found that generally</span>
<span class="sd">    0.001 ≤ p ≤ 0.1 is a good choice</span>
<span class="sd">    (for a signal with positive peaks)</span>
<span class="sd">    and 10^2 ≤ λ ≤ 10^9 ,</span>
<span class="sd">    but exceptions may occur.</span>
<span class="sd">    In any case one should vary λ on a grid</span>
<span class="sd">    that is approximately linear for log λ</span>

<span class="sd">    https://stackoverflow.com/questions/29156532/python-baseline-correction-library</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">D</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span> <span class="c1"># Precompute this term since it does not depend on `w`</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
        <span class="n">W</span><span class="o">.</span><span class="n">setdiag</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">W</span> <span class="o">+</span> <span class="n">D</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">w</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2><span class="section-number">8.5. </span>Задачи<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h2>
<ol class="arabic">
<li><p>Возьмите интеграл <span class="math notranslate nohighlight">\(\int_0^{10} dT_2  \exp \left[ - 1/T_2 \int_0^{T_2} \exp(-1/T_1) dT_1 \right]\)</span>.</p></li>
<li><p>Постройте зависимость концентраций всех форм от времени для кинетической схемы:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 64%" />
<col style="width: 36%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(A \rightarrow 2 X\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(k_1 = 1\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(X + B \rightarrow Y\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(k_2 = 5\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(2 Y \rightarrow C\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(k_3 = 4\)</span></p></td>
</tr>
</tbody>
</table>
<p>Начальные концентрации <span class="math notranslate nohighlight">\([A] = 5\)</span>; <span class="math notranslate nohighlight">\([B] = 15\)</span>; <span class="math notranslate nohighlight">\([X]=[Y]=[C]=0\)</span></p>
</div></blockquote>
</li>
<li><p>После некоторого измерения вы получили результат, представленный в <a class="reference external" href="../../source/lectures/task_8.3.csv">файле</a>. По форме кривой вы видите два наложенных сигнала. Исходя из физики процесса, вы знаете что каждый отдельный сигнал имеет форму кривой Гаусса. Постройте начальную кривую. На том же графике выделите базовую линию. Методами <code class="docutils literal notranslate"><span class="pre">scipy</span></code> найдите отдельные параметры сигналов: амплитуда, <span class="math notranslate nohighlight">\(\mu, \sigma\)</span> (не забудьте предварительно вычесть базовую линию), расчитайте ошибку аппроксимации. Проинтегрируйте пики поотдельности и найдите их соотношение площадей. На отделном графике постройте экспериментальную кривую (уже за вычетом базовой), а так же обе найденные компоненты и их сумму.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="theme9.html" class="btn btn-neutral float-right" title="9. Введение в ООП. Настройка окружения и установка пакетов" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="theme7.html" class="btn btn-neutral float-left" title="7. Работа с графиками" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright R.D.Yamaletdinov, NIIC SB RAS, 2020

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>